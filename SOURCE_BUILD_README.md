# Tab Canopy - Firefox Source Code Build Instructions

This document provides complete instructions for building the Tab Canopy browser extension from source code for Firefox.

## Repository

**GitHub**: https://github.com/firtoz/tab-canopy

## Build Environment

The extension was built and tested on the following environment:

- **Operating System**: Linux (Ubuntu/Debian-based, though compatible with macOS and Windows)
- **Build Tool**: Bun 1.3.3 or later
- **Node.js**: 18.x or later (for compatibility, though Bun is used for builds)
- **Architecture**: x64/ARM64

## Prerequisites Installation

### Install Bun (Required)

Bun is the primary build tool and package manager for this project.

**Linux/macOS**:
```bash
curl -fsSL https://bun.sh/install | bash
```

**Windows**:
```bash
powershell -c "irm bun.sh/install.ps1 | iex"
```

**Verify Installation**:
```bash
bun --version  # Should output 1.3.3 or higher
```

Alternatively, visit https://bun.sh for detailed installation instructions.

## Build Instructions

Follow these steps exactly to reproduce the Firefox build:

### 1. Clone the Repository

```bash
git clone https://github.com/firtoz/tab-canopy.git
cd tab-canopy
```

### 2. Install Dependencies

```bash
bun install
```

This will install all dependencies listed in `package.json` and `bun.lock` (lockfile).

**Important**: The `bun.lock` file ensures exact dependency versions match the submitted build.

### 3. Build the Firefox Extension

From the repository root:

```bash
bun run build:firefox
```

Or from the extension package directory:

```bash
cd packages/extension
bun wxt build -b firefox
```

This command:
- Runs database migrations
- Compiles TypeScript to JavaScript
- Bundles React components
- Processes Tailwind CSS
- Creates Firefox MV2 manifest
- Outputs to `packages/extension/.output/firefox-mv2/`

### 4. Verify the Build Output

The built extension will be located at:
```
packages/extension/.output/firefox-mv2/
```

This directory contains the exact files packaged in the submitted extension.

### 5. (Optional) Create Extension Zip

To create a zip file identical to the submission:

From the repository root:
```bash
bun run zip:firefox
```

This automatically runs the build first (WXT handles this internally).

Or from the extension package directory:
```bash
cd packages/extension
bun wxt zip -b firefox
```

Output: `packages/extension/.output/tabcanopyextension-[version]-firefox.zip`

## Build Output Comparison

After building, compare your output with the submitted extension:

1. Extract the submitted `.xpi` or `.zip` file
2. Extract your built `.zip` file from step 5
3. Use a diff tool to compare the directories
4. All files should match exactly (timestamps may differ)

## Note on Included WXT Sources.zip

This submission package includes two sets of source files:

1. **Full monorepo sources** (root level) - Complete source code including build configuration, lockfiles, and scripts needed to reproduce the build from the repository root
2. **`tabcanopyextension-[version]-sources.zip`** - Auto-generated by WXT containing only the `packages/extension/` directory for reference

Both are provided for transparency. The **full monorepo sources** are what reviewers need to reproduce the build using the instructions in this document.

## Build Tools Used

All build tools are open-source and installed via Bun:

- **WXT** (v0.20.13): Cross-browser extension framework
- **Vite** (v6.0.7): JavaScript bundler and dev server
- **TypeScript** (v5.7.3): Type checking and transpilation
- **Biome** (v1.9.4): Linting and formatting
- **Drizzle ORM** (v0.39.4): Database schema and migrations
- **React** (v19.0.0): UI framework
- **Tailwind CSS** (v4.0.0): CSS framework
- **dnd-kit** (v7.0.1): Drag-and-drop library

All dependency versions are locked in `bun.lock`.

## Project Structure

```
tabcanopy/
├── packages/
│   ├── extension/          # Main extension package
│   │   ├── entrypoints/    # Background script, sidepanel
│   │   ├── schema/         # Database schema
│   │   ├── src/            # Shared utilities
│   │   ├── wxt.config.ts   # WXT build configuration
│   │   └── package.json    # Extension dependencies
│   └── e2e-tests/          # Playwright tests (not included in build)
├── package.json            # Root workspace configuration
├── bun.lock                # Dependency lockfile
└── turbo.json              # Monorepo task runner config
```

## Extension Features

- Organizes browser tabs in a tree structure based on opener relationships
- All data stored locally in IndexedDB
- Favicons fetched directly or via corsproxy.io service (CORS proxy fallback)
- No analytics or tracking
- No external authentication required

## Notes for Reviewers

1. **Third-party Libraries**: All dependencies are open-source and listed in `package.json` and `bun.lock`
2. **Minification**: Code is minified by Vite/Rollup (part of WXT) for production builds
3. **Source Maps**: Not included in production build for size optimization
4. **Open Source**: Full source code available at https://github.com/firtoz/tab-canopy
5. **Favicon Fetching**: Extension fetches favicons through background script with fallback to corsproxy.io (https://corsproxy.io) for CORS-blocked domains

## Troubleshooting

### Build Fails with "Module not found"

Ensure you ran `bun install` in the root directory before building.

### Different Output Files

Ensure you're using Bun 1.3.3+ and have the correct `bun.lock` file. The lockfile guarantees exact dependency versions.

### Permission Errors

Ensure you have write permissions in the `packages/extension/.output/` directory.

## Support

For questions or issues:
- GitHub Issues: https://github.com/firtoz/tab-canopy/issues
- GitHub Repository: https://github.com/firtoz/tab-canopy

## License

See LICENSE file in the repository.
